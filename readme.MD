# ü§ñ WhatsApp Bot ‚Äì Fluxo Humanizado

Automa√ß√£o de mensagens no WhatsApp Desktop com **humaniza√ß√£o** (pausas rand√¥micas, digita√ß√£o natural, movimentos suaves do mouse).  
Este README explica **o que mudou**, **como configurar** e **como rodar**.

---

## üì¶ Sum√°rio
- [Vis√£o geral](#vis√£o-geral)
- [Estrutura do projeto](#estrutura-do-projeto)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Como funciona a humaniza√ß√£o](#como-funciona-a-humaniza√ß√£o)
- [O que foi alterado no c√≥digo](#o-que-foi-alterado-no-c√≥digo)
- [Execu√ß√£o](#execu√ß√£o)
- [Dicas de uso](#dicas-de-uso)
- [Solu√ß√£o de problemas](#solu√ß√£o-de-problemas)
- [FAQ](#faq)
- [Roadmap](#roadmap)
- [Licen√ßa](#licen√ßa)

---

## Vis√£o geral
Antes, o fluxo utilizava `time.sleep(...)` fixo, colava mensagens instantaneamente e clicava sem movimento.  
Agora, com o **m√≥dulo `humanizer.py`**:
- Pausas entre a√ß√µes s√£o **rand√¥micas** (`Tools.espera(a, b)`).
- Mensagem √© **digitada** (30%) ou **colada** (70%) com varia√ß√£o de tempo.
- O mouse **se move suavemente** at√© o alvo antes de clicar.
- O Enter √© enviado com **pequeno delay natural**.

Benef√≠cios:
- Fluxo mais ‚Äúhumano‚Äù e menos previs√≠vel.
- Menor risco de bloqueios por comportamento rob√≥tico.
- Configur√°vel sem mexer no c√≥digo (via `config.py`).

---

## Estrutura do projeto

```
.
‚îú‚îÄ Main.py                  # Loop principal (spins/leads/fluxo)
‚îú‚îÄ MainClass.py             # Classe Tools (UI, logs, anexos, etc.)
‚îú‚îÄ humanizer.py             # ‚Üê NOVO: m√≥dulo de humaniza√ß√£o
‚îú‚îÄ config.py                # Diret√≥rios e HUMANIZE (config da humaniza√ß√£o)
‚îú‚îÄ server.js                # API Node (whatsapp-web.js)
‚îú‚îÄ send.py                  # Cliente Python (chama API Node)
‚îú‚îÄ mailing/
‚îÇ  ‚îî‚îÄ mailing_<canal>.txt   # Mailing de teste/produ√ß√£o
‚îú‚îÄ dump_discagem/
‚îÇ  ‚îî‚îÄ discagem_<canal>.txt  # Log de discagens (gerado)
‚îú‚îÄ imgs_referencia/
‚îÇ  ‚îú‚îÄ form_mensagem.png
‚îÇ  ‚îú‚îÄ telefone_invalido.png
‚îÇ  ‚îî‚îÄ ...                   # Outros bot√µes/telas
‚îú‚îÄ tm/
‚îÇ  ‚îú‚îÄ imgs/                 # Pastas de imagens de campanha (CampanhaX)
‚îÇ  ‚îî‚îÄ msgs/                 # Textos .txt usados como template
‚îî‚îÄ logs/
   ‚îú‚îÄ log_transacional/
   ‚îî‚îÄ log_img/
```

---

## Instala√ß√£o

> Python ‚â• 3.9 recomendado. Node.js ‚â• 18 para a API.

### Depend√™ncias Python
```bash
pip install pyautogui pyperclip pywinauto pandas opencv-python pygetwindow psutil mouse requests
```

### Depend√™ncias Node
```bash
npm install whatsapp-web.js express body-parser qrcode-terminal
```

---

## Configura√ß√£o

1. **`config.py`**  
   Ajuste diret√≥rios e adicione:
   ```python
   HUMANIZE = {
       "enabled": True,
       "min_wait": 1.2, "max_wait": 3.8,
       "mouse_move_min": 0.35, "mouse_move_max": 1.15, "mouse_jitter_px": 4,
       "type_min": 0.05, "type_max": 0.14, "prob_type": 0.30,
       "micro_min": 0.20, "micro_max": 0.55,
   }
   ```

2. **`humanizer.py`**  
   Novo m√≥dulo que controla pausas, digita√ß√£o e cliques. (j√° incluso neste projeto)

3. **`MainClass.py`**  
   - Importe o Humanizer.
   - Substitua `time.sleep` por `Tools.espera`.
   - Troque `pgui.click`/`pyperclip.copy` por `Tools.click`/`Tools.escreve`.

4. **API Node (`server.js`)**  
   - Sobe um servidor Express na porta `3000`.
   - Exige `x-api-token` no header (default: `dev-token`).
   - Endpoints:
     - `/health`
     - `/send/text`
     - `/send/media`
     - `/send/bulk`

---

## Como funciona a humaniza√ß√£o

- **Pausas naturais:** `Tools.espera(2, 5)` espera entre 2‚Äì5s.
- **Escrita:** `Tools.escreve(msg)` ‚Üí 70% cola, 30% digita com varia√ß√£o.
- **Mouse:** `Tools.click((x,y))` move suavemente e clica com micro-pausa.
- **Enter:** `Tools.enter()` adiciona um pequeno delay e envia.

Tudo configur√°vel em `config.py`.

---

## O que foi alterado no c√≥digo

- `Main.py`  
  - `time.sleep(...)` ‚Üí `Tools.espera(...)` (delays humanizados).

- `MainClass.py`  
  - Classe `Tools`: novos m√©todos `espera`, `escreve`, `click`, `enter`.  
  - Substitui√ß√£o de `pyperclip+ctrl+v` e `pgui.write`.

- `server.js` e `send.py`  
  - Mant√™m API de envio de mensagens.  
  - J√° incluem jitter (atrasos aleat√≥rios) no envio em lote.

---

## Execu√ß√£o

### API Node
```bash
node server.js
```
- Na primeira vez, escaneie o QR no terminal com o WhatsApp.

### Bot Python
```bash
python Main.py
```

### Cliente Python simples
```bash
python send.py
```
- Pode enviar texto, m√≠dia ou lote via CSV.

---

## Dicas de uso

- Rode em tela maximizada, escala 100%.  
- Use imagens de refer√™ncia n√≠tidas.  
- Ajuste `HUMANIZE` para calibrar velocidade.  
- Para testes, use `canal = "teste"` no `Main.py`.  
- Ative logs de imagem para depurar pontos de clique.

---

## Solu√ß√£o de problemas

- **N√£o localiza imagem**: verifique escala 100%, capture nova refer√™ncia.  
- **WhatsApp n√£o abre**: confirme instala√ß√£o do Desktop/Edge.  
- **Mensagens r√°pidas demais**: aumente `min_wait`/`max_wait`.  
- **Erro de permiss√£o**: rode como administrador, confirme pastas no `config.py`.

---

## FAQ

**Posso desligar a humaniza√ß√£o?**  
Sim. `HUMANIZE["enabled"] = False`.

**Funciona no Linux/Mac?**  
Focado em Windows (UI Automation). Node/whatsapp-web.js roda em qualquer SO.

**Como adicionar novas campanhas?**  
Crie pasta em `tm/imgs/CampanhaX` e arquivos `.txt` em `tm/msgs/`.

---

## Roadmap

- [ ] UI Automation sem vis√£o computacional (pywinauto).  
- [ ] Perfis de humaniza√ß√£o por canal.  
- [ ] Painel de controle web.  
- [ ] Webhook de status/acks integrado com Python.

---

## Licen√ßa

Uso interno. Ajuste para MIT, GPL ou propriet√°rio conforme sua necessidade.
